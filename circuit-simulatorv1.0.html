<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>罫線 接続パズル</title>

<style>
/* ===== 全体 ===== */
body {
  font-family: monospace;
  padding: 20px;
  max-width: 1100px;
  margin: 0 auto;
  background: #ffffff;
}

h2 {
  margin-bottom: 20px;
}

/* ===== レイアウト ===== */
.container {
  display: flex;
  gap: 32px;
  align-items: flex-start;
}

/* ===== 盤面エリア ===== */
.boards {
  display: grid;
  grid-template-columns: repeat(2, auto);
  gap: 30px;
}

.board-wrapper {
  text-align: center;
}

.board-header {
  display: flex;
  justify-content: center;
  gap: 6px;
  margin-bottom: 6px;
}

.board-header input {
  width: 90px;
  text-align: center;
  font-family: monospace;
}

.board-header button {
  cursor: pointer;
}

/* ===== マス ===== */
.board {
  display: grid;
  grid-template-columns: repeat(4, 56px);
  grid-template-rows: repeat(4, 56px);
  gap: 2px;
}

.cell {
  border: 1px solid #333;
  font-size: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  user-select: none;
}

/* ===== ハイライト ===== */
.connected {
  font-weight: bold;
  box-shadow: inset 0 0 0 1px rgba(0,0,0,0.2);
}

.highlight-red {
  background: #ffe8e8;
  color: #d60000;
}

.highlight-blue {
  background: #e8f1ff;
  color: #246bff;
}

.highlight-green {
  background: #e6fffa;
  color: #0a8;
}

/* ===== 右パネル ===== */
.side-panel {
  border: 1px solid #ccc;
  padding: 14px 16px;
  border-radius: 6px;
  background: #fafafa;
  min-width: 170px;
}

.side-panel h3 {
  margin: 0 0 8px 0;
  font-size: 14px;
}

.side-panel label {
  margin-right: 10px;
  font-size: 14px;
  cursor: pointer;
}

/* ===== パレット ===== */
.palette {
  display: flex;
  gap: 12px;
  margin-top: 10px;
}

.column {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.symbol {
  width: 48px;
  height: 48px;
  border: 1px solid #aaa;
  font-size: 26px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
  background: white;
}

.symbol.selected {
  background: #007bff;
  color: white;
}
</style>
</head>

<body>

<h2>回路シミュ v1.0</h2>

<div class="container">
  <!-- ===== 盤面 ===== -->
  <div class="boards" id="boards"></div>

  <!-- ===== 右操作パネル ===== -->
  <div class="side-panel">
    <h3>回路色</h3>
    <label><input type="radio" name="hl" value="red" checked> 赤</label>
    <label><input type="radio" name="hl" value="blue"> 青</label>
    <label><input type="radio" name="hl" value="green"> 緑</label>

    <h3 style="margin-top:16px;">回路選択</h3>
    <div class="palette">
      <div class="column">
        <div class="symbol">━</div>
        <div class="symbol">┃</div>
        <div class="symbol">◯</div>
        <div class="symbol">⌫</div>
      </div>
      <div class="column">
        <div class="symbol">┗</div>
        <div class="symbol">┏</div>
        <div class="symbol">┓</div>
        <div class="symbol">┛</div>
      </div>
      <div class="column">
        <div class="symbol">┳</div>
        <div class="symbol">┫</div>
        <div class="symbol">┻</div>
        <div class="symbol">┣</div>
      </div>
    </div>
  </div>
</div>

<script>
const size = 4;
let selectedSymbol = "";
let highlightColor = "red";

const connections = {
  "━": { left:true, right:true, up:false, down:false },
  "┃": { left:false, right:false, up:true, down:true },
  "┗": { left:false, right:true, up:true, down:false },
  "┏": { left:false, right:true, up:false, down:true },
  "┓": { left:true, right:false, up:false, down:true },
  "┛": { left:true, right:false, up:true, down:false },
  "┳": { left:true, right:true, up:false, down:true },
  "┻": { left:true, right:true, up:true, down:false },
  "┣": { left:false, right:true, up:true, down:true },
  "┫": { left:true, right:false, up:true, down:true },
  "◯": { left:false, right:false, up:false, down:false }
};

/* ===== パレット選択 ===== */
document.querySelectorAll(".symbol").forEach(sym => {
  sym.onclick = () => {
    document.querySelectorAll(".symbol").forEach(s => s.classList.remove("selected"));
    sym.classList.add("selected");
    selectedSymbol = sym.textContent;
  };
});

/* ===== 色選択 ===== */
document.querySelectorAll('input[name="hl"]').forEach(r => {
  r.onchange = () => highlightColor = r.value;
});

/* ===== 盤面生成 ===== */
const boardsEl = document.getElementById("boards");

["マス1","マス2","マス3","マス4"].forEach(title => {
  const wrap = document.createElement("div");
  wrap.className = "board-wrapper";

  const header = document.createElement("div");
  header.className = "board-header";

  const input = document.createElement("input");
  input.value = title;

  const clearBtn = document.createElement("button");
  clearBtn.textContent = "Clear";

  header.append(input, clearBtn);

  const board = document.createElement("div");
  board.className = "board";

  const grid = Array.from({ length:size }, () => Array(size).fill(""));

  clearBtn.onclick = () => {
    grid.forEach(r => r.fill(""));
    board.querySelectorAll(".cell").forEach(c => {
      c.textContent = "";
      c.className = "cell";
    });
  };

  for (let y=0;y<size;y++) {
    for (let x=0;x<size;x++) {
      const cell = document.createElement("div");
      cell.className = "cell";

      cell.onclick = () => {
        if (!selectedSymbol) return;

        if (selectedSymbol === "◯") {
          const corner =
            (x===0&&y===0)||(x===0&&y===3)||(x===3&&y===0)||(x===3&&y===3);
          if (!corner) return;
        }

        if (selectedSymbol === "⌫") {
          grid[y][x] = "";
          cell.textContent = "";
        } else {
          grid[y][x] = selectedSymbol;
          cell.textContent = selectedSymbol;
        }

        update(board, grid);
      };

      board.appendChild(cell);
    }
  }

  wrap.append(header, board);
  boardsEl.appendChild(wrap);
});

/* ===== 接続判定 ===== */
function update(board, grid) {
  let hasLine = false;
  let circleConnected = false;

  const dx = { left:-1, right:1, up:0, down:0 };
  const dy = { left:0, right:0, up:-1, down:1 };
  const opp = { left:"right", right:"left", up:"down", down:"up" };

  for (let y=0;y<size;y++) {
    for (let x=0;x<size;x++) {
      const sym = grid[y][x];
      if (!sym) continue;

      if (sym !== "◯") hasLine = true;

      if (sym === "◯") {
        for (const d in dx) {
          const nx = x+dx[d], ny = y+dy[d];
          if (grid[ny]?.[nx] && grid[ny][nx] !== "◯") circleConnected = true;
        }
        continue;
      }

      for (const d in connections[sym]) {
        if (!connections[sym][d]) continue;
        const nx = x+dx[d], ny = y+dy[d];
        if (!grid[ny]?.[nx]) return clear(board);
        const t = grid[ny][nx];
        if (t !== "◯" && !connections[t][opp[d]]) return clear(board);
        if (t === "◯") circleConnected = true;
      }
    }
  }

  const ok = hasLine && circleConnected;
  board.querySelectorAll(".cell").forEach(c => {
    c.className = "cell";
    if (ok && c.textContent) {
      c.classList.add("connected","highlight-"+highlightColor);
    }
  });
}

function clear(board) {
  board.querySelectorAll(".cell").forEach(c => c.className = "cell");
}
</script>

</body>
</html>
